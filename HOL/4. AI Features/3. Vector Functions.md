# Vector Functions

In modern applications—especially those involving AI or machine learning—vector operations are fundamental. SQL Server 2025 introduces built-in vector data types and utility functions to help you store, analyze, and prepare vector data directly in the database.

In this lab, you will:

* Compute the magnitude (norm) of vectors with `VECTOR_NORM()`
* Convert raw vectors into unit vectors using `VECTOR_NORMALIZE()`
* Inspect vector metadata (dimension, length, data type) via `VECTORPROPERTY()`

These functions are essential for tasks such as similarity scoring, data normalization prior to indexing, and validating vector integrity.

By the end of this lab, you will be able to:

1. Create and populate a vector-enabled table in SQL Server.
2. Calculate vector magnitudes for use in similarity calculations.
3. Normalize vectors to unit length, preparing them for DiskANN or other ANN indexes.
4. Retrieve metadata about vector columns to validate data before indexing or analysis.

## Create the DemoVectors Table

We need a table to hold sample vector data. This simulates the kind of vector embeddings you might store after generating them from text, images, or other media.

Open a new query window in SSMS (press `CTRL+N`). Then create a dedicated lab database named `VectorDemo` to isolate your work:

```sql
CREATE DATABASE VectorDemo
GO

USE VectorDemo
GO
```

Then run the following script to create and populate a `DemoVectors` table with 4-dimensional vectors:

```sql
CREATE TABLE VectorDemo (
    VectorDemoId int PRIMARY KEY,
    RawVector vector(4)
)

INSERT INTO VectorDemo VALUES
  (1, '[1.0, 2.0, 2.0, 1.0]'),
  (2, '[0.0, 3.0, 4.0, 0.0]'),
  (3, '[2.0, 2.0, 2.0, 2.0]')
```

Notice how we define the `RawVector` column as `vector(4)`, indicating that each vector has 4 dimensions. The vectors are stored in a compact binary format internally, and represented as JSON arrays for convenience.

## Compute Norms

The **norm** (or magnitude) of a vector is a key component in cosine similarity and distance calculations.

The `VECTOR_NORM` function in SQL Server computes the magnitute of a vector using one of three different methods: `norm1`, `norm2`, and `norminf`. Each method measures the size of the vector in a different mathematical sense, corresponding to the L¹, L², and L∞ norms respectively.

### Vector Norm Types

| Norm Type | Description | Formula |
| - | - | - |
| `norm1` | **Manhattan norm** (L¹ norm, aka "taxicab geometry") – sum of absolute values of all elements. | x₁ + x₂ + ... + xₙ |
| `norm2` | **Euclidean norm** (L² norm, most common) – the straight-line distance from the origin to the point in n-dimensional space. | √(x₁² + x₂² + ... + xₙ²) |
| `norminf` | **Maximum norm** (Infinity norm, L∞) – the largest absolute value among all elements. | max(x₁, x₂, ... xₙ) |

Run this code to compute the magnitude of each vector using `VECTOR_NORM` and each of the three vector norm types:

```sql
SELECT
  VectorDemoId,
  RawVector,
  Norm1   = VECTOR_NORM(RawVector, 'norm1'),
  Norm2   = VECTOR_NORM(RawVector, 'norm2'),
  NormInf = VECTOR_NORM(RawVector, 'norminf')
FROM
  VectorDemo
```

### Expected Result

| Vector | Norm1 | Norm2 | NormInf |
| - |
| `[1.0, 2.0, 2.0, 1.0]` | 1 + 2 + 2 + 1 =<br>**6** | √(1² + 2² + 2² + 1²) =<br>√(1 + 4 + 4 + 1) =<br>√10 ≈<br>**3.1623** | max(1, 2, 2, 1) =<br>**2** |
| `[0.0, 3.0, 4.0, 0.0]` | 0 + 3 + 4 + 0 =<br>**7** | √(0² + 3² + 4² + 0²) =<br>√(0 + 9 + 16 + 0) =<br>√25 =<br>**5** | max(0, 3, 4, 0) = **4** |
| `[2.0, 2.0, 2.0, 2.0]` | 2 + 2 + 2 + 2 =<br>**8** | √(2² × 2² × 2² × 2²) =<br>√(4 × 4 × 4 × 4) =<br>√16 =<br>**4** | max(2, 2, 2, 2) = **2** |

### Summary

* Use `norm1` when you want to measure the **total "weight"** of the vector (often used in sparse data, or when dealing with taxicab geometry).
* Use `norm2` when you want to measure the **overall magnitude** of a vector (e.g., for similarity or distance calculations).
* Use `norminf` when you're interested in the **maximum deviation** along any single dimension.

Each provides different insight into the vector's shape or influence, and they are commonly used in various machine learning, search, and geometry applications.

## Normalize Vectors

ANN (Approximate Nearest Neighbor) indexes like DiskANN perform best when all vectors are normalized to unit length. `VECTOR_NORMALIZE()` scales each vector to length 1, preserving direction but standardizing magnitude.

`VECTOR_NORMALIZE` is commonly used before inserting data into DiskANN indexes.

This code normalizes the vectors to unit length.

```sql
SELECT
    Id,
    VECTOR_NORMALIZE(RawVector) AS NormalizedVector
FROM
    DemoVectors
```

#### Expected Result

| Id | NormalizedVector                  |
| -- | --------------------------------- |
| 1  | VECTOR(\[0.33, 0.67, 0.67, 0.33]) |
| 2  | VECTOR(\[0.00, 0.60, 0.80, 0.00]) |
| 3  | VECTOR(\[0.50, 0.50, 0.50, 0.50]) |

> **Precision Note:** Results may vary slightly due to floating-point precision. Use `ROUND()` if exact matching is required.

---

## Inspect Vector Properties

Before indexing or advanced analysis, it's often helpful to verify vector metadata such as dimension, total length, and underlying data type. This ensures data consistency.

The `VECTORPROPERTY` function is available for this very purpose.
Run the following code to examine properties like `Dimension`, `Length`, and `DataType`.

```sql
SELECT
    Id,
    VECTORPROPERTY(RawVector, 'Dimension') AS Dimension,
    VECTORPROPERTY(RawVector, 'Length') AS Length,
    VECTORPROPERTY(RawVector, 'DataType') AS DataType
FROM
    DemoVectors
```

#### Expected Result

| Id | Dimension | Length | DataType |
| -- | --------- | ------ | -------- |
| 1  | 4         | 4      | REAL     |
| 2  | 4         | 4      | REAL     |
| 3  | 4         | 4      | REAL     |

> **Pro Tip:** If you plan to build a DiskANN index, confirm `Dimension` matches your index definition.

---

## Wrap-Up

In this lab, you’ve:

* Created a vector-enabled table
* Calculated vector magnitudes with `VECTOR_NORM`
* Converted to unit vectors using `VECTOR_NORMALIZE`
* Retrieved metadata using `VECTORPROPERTY`

These utilities form the foundation for advanced vector operations in SQL Server 2025—paving the way for high-performance semantic search and AI integrations.

Proceed to **Lab 4** to learn how to index these vectors with DiskANN and perform high-speed similarity searches using `VECTOR_SEARCH()`.
