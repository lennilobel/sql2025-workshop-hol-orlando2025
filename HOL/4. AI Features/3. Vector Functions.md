# Vector Functions

In modern applications—especially those involving AI or machine learning—vector operations are fundamental. SQL Server 2025 introduces built-in vector data types and utility functions to help you store, analyze, and prepare vector data directly in the database.

In this lab, you will:

* Compute the magnitude (norm) of vectors with `VECTOR_NORM()`
* Convert raw vectors into unit vectors using `VECTOR_NORMALIZE()`
* Inspect vector metadata (dimension, length, data type) via `VECTORPROPERTY()`

These functions are essential for tasks such as similarity scoring, data normalization prior to indexing, and validating vector integrity.

By the end of this lab, you will be able to:

1. Create and populate a vector-enabled table in SQL Server.
2. Calculate vector magnitudes for use in similarity calculations.
3. Normalize vectors to unit length, preparing them for DiskANN or other ANN indexes.
4. Retrieve metadata about vector columns to validate data before indexing or analysis.

## Create the DemoVectors Table

We need a table to hold sample vector data. This simulates the kind of vector embeddings you might store after generating them from text, images, or other media.

Open a new query window in SSMS (press `CTRL+N`). Then create a dedicated lab database named `VectorDemo` to isolate your work:

```sql
CREATE DATABASE VectorDemo
GO

USE VectorDemo
GO
```

Then run the following script to create and populate a `DemoVectors` table with 4-dimensional vectors:

```sql
CREATE TABLE DemoVectors (
    Id INT PRIMARY KEY,
    RawVector VECTOR(REAL, 4)
)

INSERT INTO DemoVectors (Id, RawVector) VALUES
  (1, VECTOR([1.0, 2.0, 2.0, 1.0])),
  (2, VECTOR([0.0, 3.0, 4.0, 0.0])),
  (3, VECTOR([2.0, 2.0, 2.0, 2.0]))
```

> **Tip:** Use a consistent vector dimension across all rows. If you try to insert a vector of a different length, SQL Server will raise an error.

## Compute Norms

The **norm** (or magnitude) of a vector is a key component in cosine similarity and distance calculations. `VECTOR_NORM()` computes the Euclidean length of a vector in one call.

Run this code to compute the magnitude of each vector using `VECTOR_NORM`.

```sql
SELECT
  Id,
  VECTOR_NORM(RawVector) AS VectorNorm
FROM
    DemoVectors
```

#### Expected Result

| Id | VectorNorm |                          |
| -- | ---------- | ------------------------ |
| 1  | 3.00       | -- sqrt(1²+2²+2²+1²) = 3 |
| 2  | 5.00       | -- sqrt(0²+3²+4²+0²) = 5 |
| 3  | 4.00       | -- sqrt(2²+2²+2²+2²) = 4 |

> **Consideration:** You can use this result to normalize similarity scores or to compare vector lengths directly.

## Normalize Vectors

ANN (Approximate Nearest Neighbor) indexes like DiskANN perform best when all vectors are normalized to unit length. `VECTOR_NORMALIZE()` scales each vector to length 1, preserving direction but standardizing magnitude.

`VECTOR_NORMALIZE` is commonly used before inserting data into DiskANN indexes.

This code normalizes the vectors to unit length.

```sql
SELECT
    Id,
    VECTOR_NORMALIZE(RawVector) AS NormalizedVector
FROM
    DemoVectors
```

#### Expected Result

| Id | NormalizedVector                  |
| -- | --------------------------------- |
| 1  | VECTOR(\[0.33, 0.67, 0.67, 0.33]) |
| 2  | VECTOR(\[0.00, 0.60, 0.80, 0.00]) |
| 3  | VECTOR(\[0.50, 0.50, 0.50, 0.50]) |

> **Precision Note:** Results may vary slightly due to floating-point precision. Use `ROUND()` if exact matching is required.

---

## Inspect Vector Properties

Before indexing or advanced analysis, it's often helpful to verify vector metadata such as dimension, total length, and underlying data type. This ensures data consistency.

The `VECTORPROPERTY` function is available for this very purpose.
Run the following code to examine properties like `Dimension`, `Length`, and `DataType`.

```sql
SELECT
    Id,
    VECTORPROPERTY(RawVector, 'Dimension') AS Dimension,
    VECTORPROPERTY(RawVector, 'Length') AS Length,
    VECTORPROPERTY(RawVector, 'DataType') AS DataType
FROM
    DemoVectors
```

#### Expected Result

| Id | Dimension | Length | DataType |
| -- | --------- | ------ | -------- |
| 1  | 4         | 4      | REAL     |
| 2  | 4         | 4      | REAL     |
| 3  | 4         | 4      | REAL     |

> **Pro Tip:** If you plan to build a DiskANN index, confirm `Dimension` matches your index definition.

---

## Wrap-Up

In this lab, you’ve:

* Created a vector-enabled table
* Calculated vector magnitudes with `VECTOR_NORM`
* Converted to unit vectors using `VECTOR_NORMALIZE`
* Retrieved metadata using `VECTORPROPERTY`

These utilities form the foundation for advanced vector operations in SQL Server 2025—paving the way for high-performance semantic search and AI integrations.

Proceed to **Lab 4** to learn how to index these vectors with DiskANN and perform high-speed similarity searches using `VECTOR_SEARCH()`.
