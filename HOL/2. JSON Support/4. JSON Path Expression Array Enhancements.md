## JSON Path Expression Array Enhancements

SQL Server 2025 expands JSON path syntax so you can address **array elements with wildcards, ranges, and positional lists**, and it adds support for `last` to reference the final element. This makes extraction and containment checks far more expressive without resorting to `OPENJSON` hacks.

**Counting array elements.** While there isn’t a built‑in `JSON_ARRAY_LENGTH` function, we can still count with `OPENJSON`. The snippet below shows both the (commented) hypothetical function and the practical workaround.

```sql
SELECT
  CustomerId,
  CreditCardCount = (
    SELECT COUNT(*)
    FROM OPENJSON(CONVERT(nvarchar(max), CustomerJson), '$.creditCards')
  )
FROM
  Customer
```

**Pre‑2025 array access.** You could reference fixed positions only (`[0]`, `[1]`) and dot into those objects for fields like `type`.

```sql
-- Before SQL Server 2025, array references in JSON path expressions were very limited
SELECT
    CustomerId,
    AllCreditCards              = JSON_QUERY(e.CustomerJson, '$.creditCards'),
    FirstCreditCard             = JSON_QUERY(e.CustomerJson, '$.creditCards[0]'),
    FirstCreditCardType         = JSON_VALUE(e.CustomerJson, '$.creditCards[0].type'),
    SecondCreditCard            = JSON_QUERY(e.CustomerJson, '$.creditCards[1]'),
    SecondCreditCardType        = JSON_VALUE(e.CustomerJson, '$.creditCards[1].type')
FROM
    Customer AS e
```

**2025 enhancements.** Wildcards (`[*]`), ranges (`[0 to 2]`), positional lists (`[0, last]`), and `last` enable batch extraction. `WITH ARRAY WRAPPER` ensures the result is always an array even when paths match a single element.

```sql
-- SQL Server 2025 supports array wildcard and range references with JSON_QUERY, JSON_PATH_EXISTS, and JSON_CONTAINS

SELECT
    CustomerId,
    -- Before SQL Server 2025, array references in JSON path expressions were very limited
    AllCreditCardsBad           = JSON_QUERY(e.CustomerJson, '$.creditCards[*]'),
    AllCreditCards              = JSON_QUERY(e.CustomerJson, '$.creditCards[*]' WITH ARRAY WRAPPER),
    AllCreditCardTypes          = JSON_QUERY(e.CustomerJson, '$.creditCards[*].type' WITH ARRAY WRAPPER),
    FirstThreeCreditCardTypes   = JSON_QUERY(e.CustomerJson, '$.creditCards[0 to 2].type' WITH ARRAY WRAPPER),
    LastCreditCardType          = JSON_VALUE(e.CustomerJson, '$.creditCards[last].type'),
    FirstAndLastCreditCardType  = JSON_QUERY(e.CustomerJson, '$.creditCards[0, last].type' WITH ARRAY WRAPPER),
    LastAndFirstCreditCardType  = JSON_QUERY(e.CustomerJson, '$.creditCards[last, 0].type' WITH ARRAY WRAPPER),
    EveryOtherCreditCardType    = JSON_QUERY(e.CustomerJson, '$.creditCards[0, 2, 4, 6, 8].type' WITH ARRAY WRAPPER)
FROM
    Customer AS e
```

___

▶ [Lab: JSON Aggregates](https://github.com/lennilobel/sql2025-workshop-hol-orlando2025/blob/main/HOL/2.%20JSON%20Support/5.%20JSON%20Aggregates.md)

